<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†å›¾è°±ä¸SOPç®¡ç† - åŸå‹å›¾</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #09090b;
            --bg-secondary: #18181b;
            --bg-tertiary: #27272a;
            --bg-elevated: #3f3f46;
            --border-default: #3f3f46;
            --border-subtle: #27272a;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent-primary: #6366f1;
            --accent-success: #22c55e;
            --accent-warning: #f59e0b;
            --accent-error: #ef4444;
            --accent-info: #0ea5e9;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --transition-fast: 150ms ease;
            
            --node-person: #FF6B6B;
            --node-organization: #4ECDC4;
            --node-location: #45B7D1;
            --node-event: #96CEB4;
            --node-concept: #a78bfa;
            --node-document: #f472b6;
            --node-sop: #22c55e;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .top-nav {
            height: 56px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-default);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .nav-back {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
        }
        
        .nav-back:hover {
            color: var(--text-primary);
        }
        
        .nav-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .nav-tabs {
            display: flex;
            gap: 4px;
            margin-left: 24px;
        }
        
        .nav-tab {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border: none;
            background: transparent;
            transition: var(--transition-fast);
        }
        
        .nav-tab:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .nav-tab.active {
            background: var(--bg-tertiary);
            color: var(--accent-primary);
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            border: none;
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-default);
        }
        
        .btn-secondary:hover {
            background: var(--bg-elevated);
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            display: flex;
            height: calc(100vh - 56px);
        }
        
        /* å›¾è°±ç”»å¸ƒåŒºåŸŸ */
        .graph-area {
            flex: 1;
            position: relative;
            background: var(--bg-primary);
        }
        
        /* å·¥å…·æ  */
        .graph-toolbar {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 380px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }
        
        .toolbar-left {
            display: flex;
            gap: 12px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: 0 14px;
            width: 280px;
        }
        
        .search-box input {
            border: none;
            outline: none;
            background: transparent;
            padding: 10px 0;
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .search-box input::placeholder {
            color: var(--text-muted);
        }
        
        .toolbar-btn {
            padding: 10px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition-fast);
        }
        
        .toolbar-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .toolbar-right {
            display: flex;
            gap: 12px;
        }
        
        /* å›¾è°±ç”»å¸ƒ */
        .graph-canvas {
            width: 100%;
            height: 100%;
        }
        
        #graphContainer {
            width: 100%;
            height: 100%;
        }
        
        /* ç»Ÿè®¡é¢æ¿ */
        .graph-stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 16px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            z-index: 10;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        
        .stat-label {
            color: var(--text-muted);
        }
        
        .stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* å›¾ä¾‹ */
        .legend-panel {
            position: absolute;
            bottom: 20px;
            right: 400px;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            z-index: 10;
        }
        
        .legend-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        /* ç¼©æ”¾æ§åˆ¶ */
        .zoom-controls {
            position: absolute;
            bottom: 80px;
            right: 400px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            z-index: 10;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-default);
            background: var(--bg-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-secondary);
        }
        
        .zoom-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        /* å³ä¾§é¢æ¿ */
        .side-panel {
            width: 380px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-default);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
        }
        
        .panel-tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border: none;
            background: transparent;
            transition: var(--transition-fast);
        }
        
        .panel-tab:hover {
            color: var(--text-primary);
        }
        
        .panel-tab.active {
            color: var(--accent-primary);
            border-bottom: 2px solid var(--accent-primary);
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* èŠ‚ç‚¹è¯¦æƒ… */
        .node-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .node-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
        }
        
        .node-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .node-info {
            flex: 1;
        }
        
        .node-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .node-type {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .node-type .badge {
            padding: 4px 10px;
            background: var(--bg-elevated);
            border-radius: 12px;
            font-size: 12px;
        }
        
        .node-actions {
            display: flex;
            gap: 8px;
        }
        
        .node-action-btn {
            padding: 8px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
        }
        
        .node-action-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }
        
        .property-section {
            margin-bottom: 20px;
        }
        
        .property-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-subtle);
        }
        
        .property-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-subtle);
        }
        
        .property-item:last-child {
            border-bottom: none;
        }
        
        .property-key {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .property-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            max-width: 180px;
            text-align: right;
        }
        
        .property-value.editable {
            padding: 6px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            cursor: text;
        }
        
        .property-value.editable:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        /* å…³è”å®ä½“ */
        .relation-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .relation-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .relation-item:hover {
            background: var(--bg-elevated);
        }
        
        .relation-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }
        
        .relation-info {
            flex: 1;
        }
        
        .relation-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .relation-type {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* SOP ç®¡ç† */
        .sop-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .sop-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: 16px;
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .sop-item:hover {
            border-color: var(--accent-primary);
        }
        
        .sop-item.active {
            border-color: var(--accent-success);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .sop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .sop-title {
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sop-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .sop-status.active {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-success);
        }
        
        .sop-status.draft {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-warning);
        }
        
        .sop-desc {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }
        
        .sop-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .sop-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-subtle);
        }
        
        .sop-btn {
            flex: 1;
            padding: 10px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            transition: var(--transition-fast);
        }
        
        .sop-btn-secondary {
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            color: var(--text-primary);
        }
        
        .sop-btn-secondary:hover {
            background: var(--bg-elevated);
        }
        
        .sop-btn-primary {
            background: var(--accent-success);
            border: none;
            color: white;
        }
        
        /* æ›´æ–°é…ç½® */
        .update-section {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .update-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .update-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .update-option {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-default);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .update-option:hover {
            border-color: var(--accent-primary);
        }
        
        .update-option.selected {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .update-option-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .update-option-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .update-option-desc {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* å¯¼å‡ºé€‰é¡¹ */
        .export-section {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 20px;
        }
        
        .export-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .export-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .export-btn:hover {
            background: var(--bg-elevated);
            border-color: var(--accent-primary);
        }
        
        .export-icon {
            font-size: 20px;
        }
        
        .export-info {
            flex: 1;
        }
        
        .export-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .export-desc {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* Mermaid é¢„è§ˆ */
        .mermaid-preview {
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-top: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .mermaid-preview .keyword {
            color: var(--accent-primary);
        }
        
        .mermaid-preview .string {
            color: var(--accent-success);
        }
        
        /* èŠ‚ç‚¹ç¼–è¾‘æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-overlay.visible {
            display: flex;
        }
        
        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 18px;
        }
        
        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .modal-content {
            padding: 24px;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* SVG èŠ‚ç‚¹æ ·å¼ */
        .node-circle {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .node-circle:hover {
            filter: brightness(1.2);
        }
        
        .node-label {
            font-size: 11px;
            fill: var(--text-secondary);
            pointer-events: none;
        }
        
        .edge-line {
            stroke: var(--border-default);
            stroke-width: 1.5;
        }
        
        .node-highlighted .node-circle {
            stroke: var(--accent-primary);
            stroke-width: 3px;
        }
        
        .node-dimmed {
            opacity: 0.2;
        }
        
        .edge-dimmed {
            opacity: 0.1;
        }
        
        /* æ·»åŠ èŠ‚ç‚¹æŒ‰é’® */
        .add-node-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-lg);
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }
        
        .add-node-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="top-nav">
        <div class="nav-left">
            <a href="index.html" class="nav-back">
                <span>â†</span>
                <span>è¿”å›</span>
            </a>
            <span class="nav-title">ğŸ”— çŸ¥è¯†å›¾è°±ä¸SOPç®¡ç†</span>
            <div class="nav-tabs">
                <button class="nav-tab active">çŸ¥è¯†å›¾è°±</button>
                <button class="nav-tab">SOPæµç¨‹</button>
            </div>
        </div>
        <div class="nav-right">
            <button class="btn btn-secondary">
                <span>ğŸ“¤</span>
                <span>å¯¼å…¥æ•°æ®</span>
            </button>
            <button class="btn btn-primary" onclick="showUploadModal()">
                <span>ğŸ“</span>
                <span>ä¸Šä¼ æ–‡æ¡£</span>
            </button>
        </div>
    </nav>
    
    <div class="main-container">
        <!-- å›¾è°±ç”»å¸ƒåŒºåŸŸ -->
        <div class="graph-area">
            <!-- å·¥å…·æ  -->
            <div class="graph-toolbar">
                <div class="toolbar-left">
                    <div class="search-box">
                        <span>ğŸ”</span>
                        <input type="text" placeholder="æœç´¢å®ä½“èŠ‚ç‚¹..." />
                    </div>
                    <button class="toolbar-btn" onclick="refreshGraph()">
                        <span>ğŸ”„</span>
                        <span>åˆ·æ–°</span>
                    </button>
                    <button class="toolbar-btn">
                        <span>ğŸ¯</span>
                        <span>è‡ªé€‚åº”</span>
                    </button>
                </div>
                <div class="toolbar-right">
                    <button class="toolbar-btn">
                        <span>ğŸ“Š</span>
                        <span>å¸ƒå±€</span>
                    </button>
                    <button class="toolbar-btn">
                        <span>ğŸ”§</span>
                        <span>ç­›é€‰</span>
                    </button>
                </div>
            </div>
            
            <!-- å›¾è°±ç”»å¸ƒ -->
            <div class="graph-canvas">
                <svg id="graphContainer" width="100%" height="100%">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#3f3f46"/>
                        </marker>
                    </defs>
                    <g id="graphContent"></g>
                </svg>
            </div>
            
            <!-- æ·»åŠ èŠ‚ç‚¹æŒ‰é’® -->
            <button class="add-node-btn" onclick="showNodeModal()">
                <span>+</span>
                <span>æ·»åŠ èŠ‚ç‚¹</span>
            </button>
            
            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div class="graph-stats">
                <div class="stat-item">
                    <span class="stat-label">èŠ‚ç‚¹</span>
                    <span class="stat-value">24</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">è¾¹</span>
                    <span class="stat-value">42</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">SOP</span>
                    <span class="stat-value">5</span>
                </div>
            </div>
            
            <!-- å›¾ä¾‹ -->
            <div class="legend-panel">
                <div class="legend-title">å®ä½“ç±»å‹</div>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--node-concept)"></div>
                        <span>æ¦‚å¿µ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--node-document)"></div>
                        <span>æ–‡æ¡£</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--node-sop)"></div>
                        <span>SOP</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--node-event)"></div>
                        <span>äº‹ä»¶</span>
                    </div>
                </div>
            </div>
            
            <!-- ç¼©æ”¾æ§åˆ¶ -->
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <button class="zoom-btn" onclick="zoomOut()">âˆ’</button>
                <button class="zoom-btn" onclick="resetZoom()">âŒ–</button>
            </div>
        </div>
        
        <!-- å³ä¾§é¢æ¿ -->
        <div class="side-panel">
            <div class="panel-tabs">
                <button class="panel-tab active" onclick="switchPanelTab(this, 'detail')">èŠ‚ç‚¹è¯¦æƒ…</button>
                <button class="panel-tab" onclick="switchPanelTab(this, 'sop')">SOPç®¡ç†</button>
                <button class="panel-tab" onclick="switchPanelTab(this, 'config')">é…ç½®</button>
            </div>
            
            <!-- èŠ‚ç‚¹è¯¦æƒ… -->
            <div class="panel-content" id="detail-panel">
                <div class="node-card">
                    <div class="node-header">
                        <div class="node-icon" style="background: var(--node-concept)">ğŸ“„</div>
                        <div class="node-info">
                            <div class="node-name">æç°æµç¨‹</div>
                            <div class="node-type">
                                <span class="badge">æ¦‚å¿µ</span>
                                <span style="margin-left: 8px;">å…³è”åº¦: 8</span>
                            </div>
                        </div>
                    </div>
                    <div class="node-actions">
                        <button class="node-action-btn" onclick="showNodeModal()">âœï¸ ç¼–è¾‘</button>
                        <button class="node-action-btn">ğŸ”— æ·»åŠ å…³è”</button>
                        <button class="node-action-btn">ğŸ—‘ï¸</button>
                    </div>
                </div>
                
                <div class="property-section">
                    <div class="property-title">å±æ€§ä¿¡æ¯ (å¯ç¼–è¾‘)</div>
                    <div class="property-item">
                        <span class="property-key">entity_id</span>
                        <span class="property-value">withdraw_process_001</span>
                    </div>
                    <div class="property-item">
                        <span class="property-key">åç§°</span>
                        <input type="text" class="property-value editable" value="æç°æµç¨‹" />
                    </div>
                    <div class="property-item">
                        <span class="property-key">æè¿°</span>
                        <input type="text" class="property-value editable" value="ç”¨æˆ·æç°çš„å®Œæ•´æµç¨‹è¯´æ˜" />
                    </div>
                    <div class="property-item">
                        <span class="property-key">æ¥æºæ–‡æ¡£</span>
                        <span class="property-value">æç°æ“ä½œæŒ‡å—.pdf</span>
                    </div>
                    <div class="property-item">
                        <span class="property-key">åˆ›å»ºæ—¶é—´</span>
                        <span class="property-value">2026-01-27</span>
                    </div>
                </div>
                
                <div class="property-section">
                    <div class="property-title">å…³è”å®ä½“ (8)</div>
                    <div class="relation-list">
                        <div class="relation-item">
                            <div class="relation-icon" style="background: var(--node-sop)">ğŸ“‹</div>
                            <div class="relation-info">
                                <div class="relation-name">æç°ç”³è¯·SOP</div>
                                <div class="relation-type">has_sop â†’ å…³è”SOP</div>
                            </div>
                        </div>
                        <div class="relation-item">
                            <div class="relation-icon" style="background: var(--node-concept)">ğŸ’³</div>
                            <div class="relation-info">
                                <div class="relation-name">é“¶è¡Œå¡ç»‘å®š</div>
                                <div class="relation-type">requires â†’ å‰ç½®æ¡ä»¶</div>
                            </div>
                        </div>
                        <div class="relation-item">
                            <div class="relation-icon" style="background: var(--node-event)">âš ï¸</div>
                            <div class="relation-info">
                                <div class="relation-name">æç°å¤±è´¥</div>
                                <div class="relation-type">may_cause â†’ å¯èƒ½å¯¼è‡´</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SOPç®¡ç† -->
            <div class="panel-content" id="sop-panel" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <span style="font-size: 14px; font-weight: 600;">SOP æµç¨‹åˆ—è¡¨</span>
                    <button class="btn btn-primary" style="padding: 8px 14px; font-size: 13px;">
                        <span>+</span>
                        <span>æ–°å»ºSOP</span>
                    </button>
                </div>
                
                <div class="sop-list">
                    <div class="sop-item active">
                        <div class="sop-header">
                            <div class="sop-title">
                                <span>ğŸ“‹</span>
                                æç°ç”³è¯·SOP
                            </div>
                            <span class="sop-status active">å·²å‘å¸ƒ</span>
                        </div>
                        <div class="sop-desc">ç”¨æˆ·ç”³è¯·æç°çš„æ ‡å‡†æ“ä½œæµç¨‹ï¼ŒåŒ…å«èº«ä»½éªŒè¯ã€é‡‘é¢æ ¡éªŒã€é“¶è¡Œå¡éªŒè¯ç­‰æ­¥éª¤</div>
                        <div class="sop-meta">
                            <span>ğŸ“Š 8 ä¸ªæ­¥éª¤</span>
                            <span>ğŸ‘ï¸ è°ƒç”¨ 1,234 æ¬¡</span>
                            <span>â° æ›´æ–°äº 2å¤©å‰</span>
                        </div>
                        <div class="sop-actions">
                            <button class="sop-btn sop-btn-secondary">âœï¸ ç¼–è¾‘</button>
                            <button class="sop-btn sop-btn-secondary">ğŸ‘ï¸ é¢„è§ˆ</button>
                            <button class="sop-btn sop-btn-primary">ğŸ“Š Mermaid</button>
                        </div>
                    </div>
                    
                    <div class="sop-item">
                        <div class="sop-header">
                            <div class="sop-title">
                                <span>ğŸ“‹</span>
                                æç°å¤±è´¥å¤„ç†SOP
                            </div>
                            <span class="sop-status active">å·²å‘å¸ƒ</span>
                        </div>
                        <div class="sop-desc">å¤„ç†ç”¨æˆ·æç°å¤±è´¥çš„æ ‡å‡†æµç¨‹ï¼ŒåŒ…å«é”™è¯¯è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ</div>
                        <div class="sop-meta">
                            <span>ğŸ“Š 6 ä¸ªæ­¥éª¤</span>
                            <span>ğŸ‘ï¸ è°ƒç”¨ 567 æ¬¡</span>
                            <span>â° æ›´æ–°äº 5å¤©å‰</span>
                        </div>
                        <div class="sop-actions">
                            <button class="sop-btn sop-btn-secondary">âœï¸ ç¼–è¾‘</button>
                            <button class="sop-btn sop-btn-secondary">ğŸ‘ï¸ é¢„è§ˆ</button>
                            <button class="sop-btn sop-btn-primary">ğŸ“Š Mermaid</button>
                        </div>
                    </div>
                    
                    <div class="sop-item">
                        <div class="sop-header">
                            <div class="sop-title">
                                <span>ğŸ“‹</span>
                                é“¶è¡Œå¡ç»‘å®šSOP
                            </div>
                            <span class="sop-status draft">è‰ç¨¿</span>
                        </div>
                        <div class="sop-desc">ç”¨æˆ·ç»‘å®šé“¶è¡Œå¡çš„æ“ä½œæµç¨‹</div>
                        <div class="sop-meta">
                            <span>ğŸ“Š 5 ä¸ªæ­¥éª¤</span>
                            <span>â° åˆ›å»ºäº 1å¤©å‰</span>
                        </div>
                        <div class="sop-actions">
                            <button class="sop-btn sop-btn-secondary">âœï¸ ç¼–è¾‘</button>
                            <button class="sop-btn sop-btn-primary">å‘å¸ƒ</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é…ç½®é¢æ¿ -->
            <div class="panel-content" id="config-panel" style="display: none;">
                <!-- æ›´æ–°é…ç½® -->
                <div class="update-section">
                    <div class="update-title">
                        <span>ğŸ”„</span>
                        æ›´æ–°æ¨¡å¼
                    </div>
                    <div class="update-options">
                        <div class="update-option selected">
                            <div class="update-option-icon">ğŸ”„</div>
                            <div class="update-option-name">å…¨é‡æ›´æ–°</div>
                            <div class="update-option-desc">é‡æ–°æ„å»ºæ•´ä¸ªå›¾è°±</div>
                        </div>
                        <div class="update-option">
                            <div class="update-option-icon">â•</div>
                            <div class="update-option-name">å±€éƒ¨æ›´æ–°</div>
                            <div class="update-option-desc">ä»…æ›´æ–°å˜æ›´éƒ¨åˆ†</div>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;">
                        <span>ğŸš€</span>
                        <span>å¼€å§‹æ›´æ–°</span>
                    </button>
                </div>
                
                <!-- å¯¼å‡ºé€‰é¡¹ -->
                <div class="export-section">
                    <div class="export-title">
                        <span>ğŸ“¤</span>
                        å¯¼å‡ºæ ¼å¼
                    </div>
                    <div class="export-options">
                        <div class="export-btn">
                            <span class="export-icon">ğŸ“Š</span>
                            <div class="export-info">
                                <div class="export-name">Mermaid æ ¼å¼</div>
                                <div class="export-desc">å¯¼å‡ºä¸º Mermaid æµç¨‹å›¾ä»£ç </div>
                            </div>
                        </div>
                        <div class="export-btn">
                            <span class="export-icon">ğŸ“¦</span>
                            <div class="export-info">
                                <div class="export-name">JSON æ ¼å¼</div>
                                <div class="export-desc">å¯¼å‡ºå®Œæ•´å›¾è°±æ•°æ®</div>
                            </div>
                        </div>
                        <div class="export-btn">
                            <span class="export-icon">ğŸ“„</span>
                            <div class="export-info">
                                <div class="export-name">CSV æ ¼å¼</div>
                                <div class="export-desc">å¯¼å‡ºèŠ‚ç‚¹å’Œè¾¹æ•°æ®è¡¨æ ¼</div>
                            </div>
                        </div>
                        <div class="export-btn">
                            <span class="export-icon">ğŸ–¼ï¸</span>
                            <div class="export-info">
                                <div class="export-name">PNG å›¾ç‰‡</div>
                                <div class="export-desc">å¯¼å‡ºå¯è§†åŒ–å›¾ç‰‡</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mermaid é¢„è§ˆ -->
                    <div class="mermaid-preview">
<span class="keyword">graph</span> TD
    A[<span class="string">ç”¨æˆ·ç”³è¯·æç°</span>] --> B{<span class="string">èº«ä»½éªŒè¯</span>}
    B -->|<span class="string">é€šè¿‡</span>| C[<span class="string">é‡‘é¢æ ¡éªŒ</span>]
    B -->|<span class="string">å¤±è´¥</span>| D[<span class="string">æç¤ºé‡æ–°éªŒè¯</span>]
    C --> E{<span class="string">ä½™é¢å……è¶³?</span>}
    E -->|<span class="string">æ˜¯</span>| F[<span class="string">å‘èµ·æç°</span>]
    E -->|<span class="string">å¦</span>| G[<span class="string">æç¤ºä½™é¢ä¸è¶³</span>]
    F --> H[<span class="string">ç­‰å¾…åˆ°è´¦</span>]
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- èŠ‚ç‚¹ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="nodeModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">âœï¸ ç¼–è¾‘èŠ‚ç‚¹</h3>
                <button class="modal-close" onclick="hideNodeModal()">âœ•</button>
            </div>
            <div class="modal-content">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">èŠ‚ç‚¹åç§°</label>
                        <input type="text" class="form-input" value="æç°æµç¨‹" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">èŠ‚ç‚¹ç±»å‹</label>
                        <select class="form-input">
                            <option>æ¦‚å¿µ</option>
                            <option>æ–‡æ¡£</option>
                            <option>SOP</option>
                            <option>äº‹ä»¶</option>
                            <option>äººç‰©</option>
                            <option>ç»„ç»‡</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æè¿°</label>
                    <textarea class="form-input form-textarea">ç”¨æˆ·æç°çš„å®Œæ•´æµç¨‹è¯´æ˜ï¼ŒåŒ…å«ç”³è¯·ã€éªŒè¯ã€æ‰“æ¬¾ç­‰ç¯èŠ‚</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">å…³è”æ–‡æ¡£</label>
                    <select class="form-input">
                        <option>æç°æ“ä½œæŒ‡å—.pdf</option>
                        <option>å¸¸è§é—®é¢˜FAQ.md</option>
                        <option>é“¶è¡Œé™é¢ä¸€è§ˆè¡¨.xlsx</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">è‡ªå®šä¹‰å±æ€§</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="form-input" placeholder="å±æ€§å" style="width: 40%;" />
                        <input type="text" class="form-input" placeholder="å±æ€§å€¼" style="flex: 1;" />
                        <button class="btn btn-secondary" style="padding: 10px;">+</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideNodeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>
    
    <script>
        // å›¾è°±æ•°æ®
        const graphData = {
            nodes: [
                { id: 'withdraw', name: 'æç°æµç¨‹', type: 'concept' },
                { id: 'apply_sop', name: 'æç°ç”³è¯·SOP', type: 'sop' },
                { id: 'fail_sop', name: 'æç°å¤±è´¥å¤„ç†SOP', type: 'sop' },
                { id: 'bank_bind', name: 'é“¶è¡Œå¡ç»‘å®š', type: 'concept' },
                { id: 'verify', name: 'èº«ä»½éªŒè¯', type: 'event' },
                { id: 'amount_check', name: 'é‡‘é¢æ ¡éªŒ', type: 'event' },
                { id: 'withdraw_fail', name: 'æç°å¤±è´¥', type: 'event' },
                { id: 'doc_guide', name: 'æç°æ“ä½œæŒ‡å—', type: 'document' },
                { id: 'doc_faq', name: 'å¸¸è§é—®é¢˜FAQ', type: 'document' },
                { id: 't1_arrival', name: 'T+1åˆ°è´¦', type: 'concept' },
                { id: 'realtime', name: 'å®æ—¶åˆ°è´¦', type: 'concept' },
                { id: 'limit', name: 'æç°é™é¢', type: 'concept' }
            ],
            edges: [
                { source: 'withdraw', target: 'apply_sop', type: 'has_sop' },
                { source: 'withdraw', target: 'bank_bind', type: 'requires' },
                { source: 'withdraw', target: 'verify', type: 'includes' },
                { source: 'withdraw', target: 'amount_check', type: 'includes' },
                { source: 'withdraw', target: 'withdraw_fail', type: 'may_cause' },
                { source: 'withdraw_fail', target: 'fail_sop', type: 'handled_by' },
                { source: 'withdraw', target: 'doc_guide', type: 'documented_in' },
                { source: 'withdraw', target: 't1_arrival', type: 'option' },
                { source: 'withdraw', target: 'realtime', type: 'option' },
                { source: 'withdraw', target: 'limit', type: 'constrained_by' }
            ]
        };
        
        const typeColors = {
            'concept': '#a78bfa',
            'sop': '#22c55e',
            'document': '#f472b6',
            'event': '#96CEB4'
        };
        
        let currentScale = 1;
        let currentTranslate = { x: 0, y: 0 };
        let nodePositions = {};
        
        function initGraph() {
            const container = document.getElementById('graphContainer');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            graphData.nodes.forEach((node, i) => {
                const angle = (i / graphData.nodes.length) * 2 * Math.PI;
                const radius = Math.min(width, height) * 0.3;
                nodePositions[node.id] = {
                    x: width / 2 + radius * Math.cos(angle) + (Math.random() - 0.5) * 80,
                    y: height / 2 + radius * Math.sin(angle) + (Math.random() - 0.5) * 80
                };
            });
            
            renderGraph();
        }
        
        function renderGraph() {
            const content = document.getElementById('graphContent');
            content.innerHTML = '';
            
            // ç»˜åˆ¶è¾¹
            const edgesGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            graphData.edges.forEach(edge => {
                const source = nodePositions[edge.source];
                const target = nodePositions[edge.target];
                if (!source || !target) return;
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', source.x);
                line.setAttribute('y1', source.y);
                line.setAttribute('x2', target.x);
                line.setAttribute('y2', target.y);
                line.setAttribute('class', 'edge-line');
                line.setAttribute('marker-end', 'url(#arrowhead)');
                edgesGroup.appendChild(line);
            });
            content.appendChild(edgesGroup);
            
            // ç»˜åˆ¶èŠ‚ç‚¹
            const nodesGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            graphData.nodes.forEach(node => {
                const pos = nodePositions[node.id];
                const color = typeColors[node.type] || '#71717a';
                
                const nodeGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                nodeGroup.setAttribute('transform', `translate(${pos.x}, ${pos.y})`);
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('r', node.type === 'sop' ? 25 : 20);
                circle.setAttribute('fill', color);
                circle.setAttribute('class', 'node-circle');
                circle.setAttribute('stroke', '#09090b');
                circle.setAttribute('stroke-width', '2');
                
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('y', 35);
                label.setAttribute('class', 'node-label');
                label.setAttribute('text-anchor', 'middle');
                label.textContent = node.name.length > 8 ? node.name.substring(0, 8) + '...' : node.name;
                
                nodeGroup.appendChild(circle);
                nodeGroup.appendChild(label);
                nodesGroup.appendChild(nodeGroup);
            });
            content.appendChild(nodesGroup);
            
            content.setAttribute('transform', `translate(${currentTranslate.x}, ${currentTranslate.y}) scale(${currentScale})`);
        }
        
        function zoomIn() {
            currentScale = Math.min(currentScale * 1.2, 3);
            renderGraph();
        }
        
        function zoomOut() {
            currentScale = Math.max(currentScale / 1.2, 0.3);
            renderGraph();
        }
        
        function resetZoom() {
            currentScale = 1;
            currentTranslate = { x: 0, y: 0 };
            renderGraph();
        }
        
        function refreshGraph() {
            initGraph();
        }
        
        function switchPanelTab(element, panelId) {
            document.querySelectorAll('.panel-tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            
            document.querySelectorAll('.panel-content').forEach(panel => panel.style.display = 'none');
            document.getElementById(panelId + '-panel').style.display = 'block';
        }
        
        function showNodeModal() {
            document.getElementById('nodeModal').classList.add('visible');
        }
        
        function hideNodeModal() {
            document.getElementById('nodeModal').classList.remove('visible');
        }
        
        // æ›´æ–°æ¨¡å¼é€‰æ‹©
        document.querySelectorAll('.update-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.update-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
            });
        });
        
        window.addEventListener('load', initGraph);
        window.addEventListener('resize', initGraph);
    </script>
</body>
</html>
